/**
 * sofa-state-resolver-service - v0.2.2 - 2014-12-18
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO).
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(a){"use strict";a.define("sofa.StateResolver",function(a,b,c){var d=c.get("apiEndpoint")+"states";return function(a){return b({method:"POST",url:d,data:a})}}),a.define("sofa.StateResolverService",function(b,c,d){var e={},f=new a.StateResolver(b,c,d),g=d.get("storeCode"),h=d.get("useShopUrls"),i={};return e.registerState=function(a){i[a.url]=a},e.resolveState=function(a){var c=b.defer();return h||"/"!==a.charAt(0)?0===a.indexOf("/!/")&&(a=a.substr(2)):a=a.substr(1),i[a]?c.resolve(i[a]):f({storeCode:g,url:a}).then(function(a){c.resolve(a.data)},function(){c.reject()}),c.promise},e})}(sofa);